---
title: "STAT 331 Portfolio"
author: "Anissa Soungpanya"
format: html 
embed-resources: true
layout: margin-left
editor: visual
execute: 
  eval: false
  echo: true
---

[**My Grade:**]{.underline} I believe my grade equivalent to course work evidenced below to be an \_\_.

[**Learning Objective Evidence:**]{.underline} In the code chunks below, provide code from Lab or Challenge assignments where you believe you have demonstrated proficiency with the specified learning target. Be sure to specify **where** the code came from (e.g., Lab 4 Question 2).

## Working with Data

**WD-1: I can import data from a *variety* of formats (e.g., csv, xlsx, txt, etc.).**

-   `csv` Example 1

```{r}
#| label: wd-1-csv-1

# Lab 2, Question 1
surveys <- read_csv(here::here("Week-2", "Lab-2", "Data", "surveys.csv"))
```

-   `csv` Example 2

```{r}
#| label: wd-1-csv-2

# Lab 3, Question 2
teacher_evals <- readr::read_csv(
  here("Week-3", "Lab-3", "data", "teacher_evals.csv"),
  show_col_types = FALSE)
```

-   `xlsx`

```{r}
#| label: wd-1-xlsx

# PA 4
military <- read_xlsx("gov_spending_per_capita.xlsx",
                      sheet = "Share of Govt. spending",
                      skip  = 7,
                      n_max = 190, na = c('..', '. .', 'xxx')
)
```

**WD-2: I can select necessary columns from a dataset.**

-   Example selecting specified columns

```{r}
#| label: wd-2-ex-1

# Lab 3, Question 5
teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  group_by(course_id, teacher_id) |>
  filter(no_participants >= 10) |>
  ungroup() |>
  mutate(
  across(teacher_id, as.character),
  across(c(question_no, academic_degree, sex), as.factor),
  seniority = as.integer(seniority)
  ) |>
  select(
  course_id, teacher_id, question_no, no_participants, resp_share,
  SET_score_avg, percent_failed_cur, academic_degree, seniority, sex
)
```

-   Example removing specified columns

```{r}
#| label: wd-2-ex-2

# Lab 3, Question 10
teacher_evals_clean |>
  filter(question_no == "901") |>
  summarise(
    avg_q1 = mean(SET_score_avg, na.rm = TRUE),
    n_courses = n_distinct(course_id),
    .by = teacher_id
  ) |>
  filter(n_courses >= 5) |>
  mutate(
    r_low = dense_rank(avg_q1),
    r_high = dense_rank(desc(avg_q1)),
    which = case_when(r_low == 1 ~ "lowest", r_high == 1 ~ "highest")
  ) |>
  filter(!is.na(which)) |>
  select(which, teacher_id, n_courses, avg_q1) |>
  arrange(desc(which)) 
```

-   Example selecting columns based on logical values (e.g., `starts_with()`, `ends_with()`, `contains()`, `where()`)

```{r}
#| label: wd-2-ex-3

# Modified Lab 2, Question 2 to use where()
surveys |>
  select(where(is.numeric)) |>
  glimpse()
```

**WD-3: I can filter rows from a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-3-numeric-ex-1

# Lab 5, Question 1
filtered_report <- crime_scene_report |>
  filter(type == "murder",
         city == "SQL City",
          date == ymd("20180115")) |>
  select(date, type, city, description)
```

-   Numeric Example 2

```{r}
#| label: wd-3-numeric-ex-2

# Lab 3, Question 10
teacher_evals_clean |>
  filter(question_no == "901") |>
  summarise(
    avg_q1 = mean(SET_score_avg, na.rm = TRUE),
    n_courses = n_distinct(course_id),
    .by = teacher_id
  ) |>
  filter(n_courses >= 5) |>
  mutate(
    r_low = dense_rank(avg_q1),
    r_high = dense_rank(desc(avg_q1)),
    which = case_when(r_low == 1 ~ "lowest", r_high == 1 ~ "highest")
  ) |>
  filter(!is.na(which)) |>
  select(which, teacher_id, n_courses, avg_q1) |>
  arrange(desc(which)) 
```

-   Character Example 1 (any context)

```{r}
#| label: wd-3-character

# Lab 5, Question 1
filtered_report <- crime_scene_report |>
  filter(type == "murder",
         city == "SQL City",
          date == ymd("20180115")) |>
  select(date, type, city, description)
```

-   Character Example 2 (example must use functions from **stringr**)

```{r}
#| label: wd-3-string

# Lab 5, Finding the Witnesses
witness_2 <- person |>
  filter(address_street_name == "Franklin Ave",
         str_detect(name, regex("^Annabel", ignore_case = TRUE))) |>
  select(id, name, address_number, address_street_name)
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-3-date

# Lab 5, Crime Scene Report
filtered_report <- crime_scene_report |>
  filter(type == "murder",
         city == "SQL City",
          date == ymd("20180115")) |>
  select(date, type, city, description)
```

**WD-4: I can modify existing variables and create new variables in a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-4-numeric-ex-1

# Lab 3, Question 10
teacher_evals_clean |>
  filter(question_no == "901") |>
  summarise(
    avg_q1 = mean(SET_score_avg, na.rm = TRUE),
    n_courses = n_distinct(course_id),
    .by = teacher_id
  ) |>
  filter(n_courses >= 5) |>
  mutate(
    r_low = dense_rank(avg_q1),
    r_high = dense_rank(desc(avg_q1)),
    which = case_when(r_low == 1 ~ "lowest", r_high == 1 ~ "highest")
  ) |>
  filter(!is.na(which)) |>
  select(which, teacher_id, n_courses, avg_q1) |>
  arrange(desc(which)) 
```

-   Numeric Example 2

```{r}
#| label: wd-4-numeric-ex-2

# Lab 3, Question 12
result <- bind_rows(highest, lowest) |>
  mutate(avg_resp_pct = round(100 * avg_resp, 1)) |>
  select(which, teacher_id, degree, seniority, sex, n_courses, avg_resp_pct) |>
  arrange(desc(which))
```

-   Factor Example 1 (renaming levels)

```{r}
#| label: wd-4-factor-ex-1

# Lab-4, Question 4
ca_childcare <- ca_childcare |>
  mutate(
    county_name = str_remove(county_name, " County"),
    region = fct_collapse(
      as_factor(county_name),
      "Superior California"    = superior_counties,
      "North Coast"            = north_coast_counties,
      "San Francisco Bay Area" = san_fran_counties,
      "North San Joaquin"      = n_san_joaquin_counties,
      "Central Coast"          = central_coast_counties,
      "South San Joaquin"      = s_san_joaquin_counties,
      "Inland Empire"          = inland_counties,
      "Los Angeles"            = la_county,
      "Orange"                 = orange_county,
      "San Diego-Imperial"     = san_diego_imperial_counties
    )
  )
```

-   Factor Example 2 (reordering levels)

```{r}
#| label: wd-4-factor-ex-2

# Lab-4, Question 7

# Growing comments: Nice work pivoting and modifying the age variable! Technically, recode() has been superseded. Meaning, there are other functions you should use instead. factor() works, but you were asked to use a function from the forcats package to accomplish this!

# I replaced factor() with fct_relevel() and replaced recode() with fct_recode(). This way, I was able to use forcats functions that are more current, specialized for factors and easier to read.

plot_df <- ca_childcare |>
  select(region, county_name, study_year, mc_infant, mc_toddler, mc_preschool) |>
  pivot_longer(
    cols = c(mc_infant, mc_toddler, mc_preschool),
    names_to = "age_group",
    values_to = "price"
  ) |>
  mutate(
    age_group = fct_recode(age_group,
      "Infant" = "mc_infant",
      "Toddler" = "mc_toddler",
      "Preschool" = "mc_preschool"
    ),
    age_group = fct_relevel(age_group, "Infant", "Toddler", "Preschool"),
    region    = fct_reorder2(region, study_year, price)
  )
```

-   Character (example must use functions from **stringr**)

```{r}
#| label: wd-4-string

# Lab 5, Finding the Witnesses (modified to use stringr to modify a character variable)
witness_2 <- person |>
  filter(
    address_street_name == "Franklin Ave",
    str_detect(name, regex("^Annabel", ignore_case = TRUE))
  ) |>
  mutate(
    name_upper = str_to_upper(name)
  ) |>
  select(id, name, name_upper, address_number, address_street_name)
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-4-date

# Lab 5, Question 1
crime_scene_report <- crime_scene_report |>
  mutate(date = normalize_ymd(date))
```

**WD-5: I can use mutating joins to combine multiple dataframes.**

-   `left_join()` Example 1

```{r}
#| label: wd-5-left-ex-1

# Lab 4, Question 2
ca_childcare <- childcare_costs |>
  left_join(counties, by = "county_fips_code") |>
  filter(state_abbreviation == "CA") |>
  select(
  county_fips_code, county_name, state_name, 
  state_abbreviation, everything())

```

-   `right_join()` Example 1

```{r}
#| label: wd-5-right

# Modified Lab 4, Question 2 to use right_join()
ca_childcare_right <- counties |>
  right_join(childcare_costs, by = "county_fips_code"
```

-   `left_join()` **or** `right_join()` Example 2

```{r}
#| label: wd-5-left-right-ex-2

# Lab 4, Question 3
# edited so functions are no longer nested
ca_keys <- ca_childcare |>
  select(county_name, study_year) |>
  distinct()

tax_rev_clean <- tax_rev |>
  rename(
    county_name = entity_name,
    study_year  = year
  ) |>
  semi_join(ca_keys, by = c("county_name", "study_year")) |>
  arrange(county_name, study_year) |>
  distinct(county_name, study_year, .keep_all = TRUE)

ca_childcare <- ca_childcare |>
  left_join(tax_rev_clean, by = c("county_name", "study_year"))

```

-   `inner_join()` Example 1

```{r}
#| label: wd-5-inner-ex-1

# Lab 5, Question 2
witness_1_interview <- interview |>
  inner_join(witness_1, by = c("person_id" = "id")) 
```

-   `inner_join()` Example 2

```{r}
#| label: wd-5-inner-ex-2

# Lab 5, Question 2
witness_2_interview <- interview |>
  inner_join(witness_2, by = c("person_id" = "id")) |>
  select(name, transcript)
```

**WD-6: I can use filtering joins to filter rows from a dataframe.**

-   `semi_join()`

```{r}
#| label: wd-6-semi

# Lab 4, Question 3
# Edited so functions are no longer nested
ca_keys <- ca_childcare |>
  select(county_name, study_year) |>
  distinct()

tax_rev_renamed <- tax_rev |>
  rename(
    county_name = entity_name,
    study_year  = year
  )

tax_rev_filtered <- tax_rev_renamed |>
  semi_join(
    ca_keys,
    by = c("county_name", "study_year")
  )

tax_rev_dedup <- tax_rev_filtered |>
  arrange(county_name, study_year) |>
  distinct(county_name, study_year, .keep_all = TRUE)

ca_childcare <- ca_childcare |>
  left_join(
    tax_rev_dedup,
    by = c("county_name", "study_year")
  )
```

-   `anti_join()`

```{r}
#| label: wd-6-anti

# Lab 5, Question 6 modified to use anti_join()

non_members <- person |>
  anti_join(get_fit_now_member, by = c("id" = "person_id"))
```

**WD-7: I can pivot dataframes from long to wide and visa versa**

-   `pivot_longer()`

```{r}
#| label: wd-7-long

# Lab 4, Question 7
plot_df <- ca_childcare |>
  select(region, county_name, study_year, mc_infant, mc_toddler, mc_preschool) |>
  pivot_longer(c(mc_infant, mc_toddler, mc_preschool),
               names_to = "age_group", values_to = "price") |>
  mutate(
    age_group = recode(age_group,
                       mc_infant = "Infant",
                       mc_toddler = "Toddler",
                       mc_preschool = "Preschool"),
    age_group = factor(age_group, levels = c("Infant","Toddler","Preschool")),
    region    = fct_reorder2(region, study_year, price)   
  )
```

-   `pivot_wider()`

```{r}
#| label: wd-7-wide

# Lab 8, Question 2
pivot_table <- function(df, row, col){
  df |>
    count({{ row }}, {{ col }}) |>
    pivot_wider(
      names_from  = {{ col }},
      values_from = n,
      values_fill = 0
    ) |>
    adorn_totals(where = c("row", "col"))
}
```

## Reproducibility

**R-1: I can create professional looking, reproducible analyses using RStudio projects, Quarto documents, and the here package.**

The following assignments satisfy the above criteria:

-   Example 1
-   Example 2
-   Example 3
-   Example 4
-   Example 5

**R-2: I can write well documented and tidy code.**

-   Example of **ggplot2** plotting

```{r}
#| label: r-2-1

# Lab 4, Question 8
ggplot(filter(ca_childcare, study_year == 2018), 
  aes(x = mhi_2018, y = mc_infant, color = region)) +
  geom_point(alpha = 0.5) +
  geom_smooth(aes(group = 1), method = "lm", se = TRUE, 
    color = "black", linewidth = 0.9) +
  labs(
    title = "Infant Center-Based Price vs. Median Household Income (CA)",
    x = "Median household income (2018 $)",
    y = "Weekly infant price ($)"
  ) +
  theme_minimal()
```

-   Example of **dplyr** pipeline

```{r}
#| label: r-2-2

# Lab 3, Question 5
teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  group_by(course_id, teacher_id) |>
  filter(no_participants >= 10) |>
  ungroup() |>
  mutate(
  across(teacher_id, as.character),
  across(c(question_no, academic_degree, sex), as.factor),
  seniority = as.integer(seniority)
  ) |>
  select(
  course_id, teacher_id, question_no, no_participants, resp_share,
  SET_score_avg, percent_failed_cur, academic_degree, seniority, sex
)
```

-   Example of function formatting

```{r}
#| label: r-2-3

# Lab 8, Question 4
style_plot <- function(my_plot, theme_fn = theme_bw, 
                       palette = brewer.pal(8, "Set2"), aesthetic) {
  if (aesthetic == "fill"){
    my_plot + theme_fn() + scale_fill_manual(values = palette)
  } else {
    my_plot + theme_fn() + scale_color_manual(values = palette)
  }
}
```

**R-3: I can write robust programs that are resistant to changes in inputs.**

-   Example (any context)

```{r}
#| label: r-3-example

# Lab 8, Question 10
mycifun <- function(beta0, beta1, n) {
  if (!is.numeric(beta0) || !is.numeric(beta1)) stop("beta0 and beta1 must be numeric.")
  if (n <= 1 || !is.numeric(n)) stop("`n` must be a numeric value greater than 1.")
  
  x  <- runif(n, min = 0, max = 1)
  ep <- rnorm(n, mean = 0, sd = 1) 
  
  y <- beta0 + beta1 * x + ep
  
  dat <- tibble(x = x, y = y)
  fit <- lm(y ~ x, data = dat)
  
  tidy(fit, conf.int = TRUE) |>
    filter(term == "x") |>
    transmute(
      beta1_hat = estimate,
      ci_low    = conf.low,
      ci_high   = conf.high,
      cover     = if_else(
        beta1 >= ci_low & beta1 <= ci_high,
        1L,
        0L
      )
    )
}

```

-   Example (function stops)

```{r}
#| label: r-3-function-stops

# Lab 8, Question 1
rescale_01 <- function(vec) {
  if (!is.numeric({{ vec }})) stop("`vec` must be numeric.")
  if (length({{ vec }}) <= 1L) stop("`vec` must have length > 1.")
  
  rng <- range({{ vec }}, na.rm = TRUE)
  denom <- diff(rng)
  
  if (denom == 0) return(ifelse(is.na({{ vec }}), NA_real_, 0))
  
  ({{ vec }} - rng[1]) / denom
}
```

## Data Visualization & Summarization

**DVS-1: I can create visualizations for a *variety* of variable types (e.g., numeric, character, factor, date)**

-   At least two numeric variables

```{r}
#| label: dvs-1-num

# Lab 4, Question 8
ggplot(filter(ca_childcare, study_year == 2018), 
  aes(x = mhi_2018, y = mc_infant, color = region)) +
  geom_point(alpha = 0.5) +
  geom_smooth(aes(group = 1), method = "lm", se = TRUE, 
    color = "black", linewidth = 0.9) +
  labs(
    title = "Infant Center-Based Price vs. Median Household Income (CA)",
    x = "Median household income (2018 $)",
    y = "Weekly infant price ($)"
  ) +
  theme_minimal()
```

-   At least one numeric variable and one categorical variable

```{r}
#| label: dvs-2-num-cat

# Lab 1, Question 6
ggplot(data = ToothGrowth, 
       mapping = aes(x = supp, y = len)) +
  geom_boxplot() +
  labs(
    x = "Supplement",
    y = "Length of Teeth (mm)"
  )
```

-   At least two categorical variables

```{r}
#| label: dvs-2-cat

# Challenge 2, Hot Option
p_hot <- ggplot(
  surv2, 
  aes(x = species, y = weight, fill = sex)
) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(
    aes(color = sex),
    alpha    = 0.35,
    size     = 1.2,
    position = position_jitterdodge(
      jitter.width  = 0.15,
      jitter.height = 0,
      dodge.width   = 0.75
    )
  ) +
  scale_fill_manual(values = sex_cols, name = "Sex") +
  scale_color_manual(values = sex_cols, guide = "none") +
  labs(
    title    = "Rodent Weight by Species",
    x        = "Species",
    y        = "Weight (g)"
  )
```

-   Dates (time series plot)

```{r}
#| label: dvs-2-date

# Lab 4, Question 7
ggplot(plot_df, aes(study_year, price, color = region)) +
  geom_point(alpha = 0.5, size = 1.2) +
  geom_smooth(method = "loess", se = TRUE, linewidth = 0.8) +
  facet_wrap(~ age_group, nrow = 1) +
  scale_x_continuous(breaks = c(2008, 2010, 2012, 2014, 2016, 2018),
                     name = "Study Year") +
  scale_y_continuous(breaks = c(100, 200, 300, 400, 500),
                     labels = scales::number_format(accuracy = 1),  
                     name = NULL) +
  coord_cartesian(xlim = c(2008, 2018), ylim = c(100, 500), clip = "off") +
  scale_color_manual(values = cols, name = "California Region") +
  labs(title = "Weekly Median Price for Center-Based Childcare ($)") +
  theme_minimal(base_size = 12) +
  theme(
    aspect.ratio = 1,
    panel.grid.minor = element_blank(),
    axis.text.x = element_text(size = 6),   
    legend.position = "right",               
    legend.justification = "center",
    legend.box.margin = margin(0, 0, 0, 10),
    plot.margin = margin(5.5, 20, 5.5, 5.5)
  )
```

**DVS-2: I use plot modifications to make my visualization clear to the reader.**

-   I can modify my plot theme to be more readable

```{r}
#| label: dvs-2-ex-1

# Lab 2, Question 16
ggplot(surveys, aes(x = weight, y = species)) +
  geom_boxplot(outlier.shape = NA, orientation = "y") +
  geom_jitter(
    orientation = "y",
    height = 0.2, width = 0,
    color = "steelblue", alpha = 0.35
  ) +
  labs(
    title = "Weight by Species",
    x = "Weight (g)",
    y = "Species"
  )
```

-   I can modify my colors to be accessible to anyone's eyes

```{r}
#| label: dvs-2-ex-2

# Challenge 2, Hot Option
sex_cols <- c(
  F = "#E15759", 
  M = "#4E79A7"  
)

ggplot(
  surv2, 
  aes(x = species, y = weight, fill = sex)
) +
  geom_boxplot(outlier.shape = NA) +
  scale_fill_manual(values = sex_cols, name = "Sex") +
  scale_color_manual(values = sex_cols, guide = "none")
```

-   I can modify my plot titles to clearly communicate the data context

```{r}
#| label: dvs-2-ex-3

# Lab-4, Question 8

# Growing comments: I don't need regions in this plot! Wouldn’t it be nice to add $ signs before these currency values?

# I removed regions from the plot and added dollar signs befor the currency values. This helps to improve readability and provides a clear plot.

ggplot(
  filter(ca_childcare, study_year == 2018),
  aes(x = mhi_2018, y = mc_infant)
) +
  geom_point(alpha = 0.6, color = "#2C3E50") + 
  geom_smooth(method = "lm", se = TRUE, color = "black", linewidth = 0.9) +
  scale_x_continuous(
    labels = label_dollar(accuracy = 1), 
    name = "Median Household Income (2018 $)"
  ) +
  scale_y_continuous(
    labels = label_dollar(accuracy = 1),  
    name = "Weekly Infant Price ($)"
  ) +
  labs(
    title = "Infant Center-Based Price vs. Median Household Income (CA, 2018)"
  ) +
  theme_minimal()
```

-   I can modify the text in my plot to be more readable

```{r}
#| label: dvs-2-ex-4

# Lab 2, Question 9
ggplot(surveys, mapping = aes(x = species, y = weight, color = species)) +
  geom_boxplot(outlier.shape = NA) +
  scale_fill_brewer(palette = "Set1") +
  labs(
    y     = "Weight",
    x     = "Species (g)",
    title = "Species v. Weight (g)"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

-   I can reorder my legend to align with the colors in my plot

```{r}
#| label: dvs-2-ex-5

# Lab 4, Question 7
ggplot(plot_df, aes(study_year, price, color = region)) +
  geom_point(alpha = 0.5, size = 1.2) +
  geom_smooth(method = "loess", se = TRUE, linewidth = 0.8) +
  facet_wrap(~ age_group, nrow = 1) +
  scale_x_continuous(breaks = c(2008, 2010, 2012, 2014, 2016, 2018),
                     name = "Study Year") +
  scale_y_continuous(breaks = c(100, 200, 300, 400, 500),
                     labels = scales::number_format(accuracy = 1),  
                     name = NULL) +
  coord_cartesian(xlim = c(2008, 2018), ylim = c(100, 500), clip = "off") +
  scale_color_manual(values = cols, name = "California Region") +
  labs(title = "Weekly Median Price for Center-Based Childcare ($)") +
  theme_minimal(base_size = 12) +
  theme(
    aspect.ratio = 1,
    panel.grid.minor = element_blank(),
    axis.text.x = element_text(size = 6),   
    legend.position = "right",               
    legend.justification = "center",
    legend.box.margin = margin(0, 0, 0, 10),
    plot.margin = margin(5.5, 20, 5.5, 5.5)
  )
```

**DVS-3: I show creativity in my visualizations**

-   I can use non-standard colors (Example 1)

```{r}
#| label: dvs-3-1-ex-1

# Challenge 4
ggplot(trend, aes(x = study_year, y = median_price, color = setting)) +
  geom_line(linewidth = 0.9) +
  geom_point(size = 1.8, alpha = 0.8) +
  facet_wrap(~ age_group, nrow = 1) +
  scale_x_continuous(breaks = c(2008, 2010, 2012, 2014, 2016, 2018),
                     name = "Study Year") +
  scale_y_continuous(labels = dollar, name = "Statewide median weekly price") +
  scale_color_brewer(palette = "Set2", name = "Setting") +
  labs(title = "Center-based vs Family (in-home) Childcare Prices in California",
       subtitle = "Statewide medians across counties, 2008–2018") +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "bottom",
    panel.grid.minor = element_blank()
  )
```

-   I can use non-standard colors (Example 2)

```{r}
#| label: dvs-3-1-ex-2

# Lab 4, Question 7
cols <- hcl.colors(nlevels(plot_df$region), "Dark 3")

ggplot(plot_df, aes(study_year, price, color = region)) +
  geom_point(alpha = 0.5, size = 1.2) +
  geom_smooth(method = "loess", se = TRUE, linewidth = 0.8) +
  facet_wrap(~ age_group, nrow = 1) +
  scale_x_continuous(breaks = c(2008, 2010, 2012, 2014, 2016, 2018),
                     name = "Study Year") +
  scale_y_continuous(breaks = c(100, 200, 300, 400, 500),
                     labels = scales::number_format(accuracy = 1),  
                     name = NULL) +
  coord_cartesian(xlim = c(2008, 2018), ylim = c(100, 500), clip = "off") +
  scale_color_manual(values = cols, name = "California Region") +
  labs(title = "Weekly Median Price for Center-Based Childcare ($)") +
  theme_minimal(base_size = 12) +
  theme(
    aspect.ratio = 1,
    panel.grid.minor = element_blank(),
    axis.text.x = element_text(size = 6),   
    legend.position = "right",               
    legend.justification = "center",
    legend.box.margin = margin(0, 0, 0, 10),
    plot.margin = margin(5.5, 20, 5.5, 5.5)
  )
```

-   I can use annotations (e.g., `geom_text()`)

```{r}
#| label: dvs-3-2

# Lab 10, Quesion 13
# Modified to use geom_text()
true_beta1 <- 0.5

ci_df |>
  mutate(sim_id = row_number()) |>
  ggplot(aes(x = sim_id)) +
  geom_segment(
    aes(
      xend = sim_id,
      y    = ci_low,
      yend = ci_high,
      color = factor(cover)
    ),
    linewidth = 0.8
  ) +
  geom_hline(yintercept = true_beta1, linetype = "dashed", linewidth = 1) +
  geom_text(
    aes(
      x = max(sim_id) * 0.8,
      y = true_beta1 + 0.02,
      label = "True slope = 0.5"
    ),
    color = "black",
    size = 4,
    fontface = "bold"
  ) +
  coord_flip() +
  labs(
    x = "Simulation index",
    y = "Slope estimate (with 95% CI)",
    title = "Confidence Interval Coverage for Slope",
    color = "Covers\ntrue slope"
  ) +
  theme_minimal()

```

-   I can choose creative geometries (e.g., `geom_segment()`, `geom_ribbon)()`)

```{r}
#| label: dvs-3-3

# Lab 10, Quesion 13
# Modified to use geom_segment()
true_beta1 <- 0.5

ci_df |>
  mutate(sim_id = row_number()) |>
  ggplot(aes(x = sim_id)) +
  geom_segment(
    aes(
      xend = sim_id,
      y    = ci_low,
      yend = ci_high,
      color = factor(cover)
    ),
    linewidth = 0.8
  ) +
  geom_hline(yintercept = true_beta1, linetype = "dashed", linewidth = 1) +
  geom_text(
    aes(
      x = max(sim_id) * 0.8,
      y = true_beta1 + 0.02,
      label = "True slope = 0.5"
    ),
    color = "black",
    size = 4,
    fontface = "bold"
  ) +
  coord_flip() +
  labs(
    x = "Simulation index",
    y = "Slope estimate (with 95% CI)",
    title = "Confidence Interval Coverage for Slope",
    color = "Covers\ntrue slope"
  ) +
  theme_minimal()

```

**DVS-4: I can calculate numerical summaries of variables.**

-   Example using `summarize()`

```{r}
#| label: dvs-4-summarize

# Lab 3, Question 10
teacher_evals_clean |>
  filter(question_no == "901") |>
  summarise(
    avg_q1 = mean(SET_score_avg, na.rm = TRUE),
    n_courses = n_distinct(course_id),
    .by = teacher_id
  ) |>
  filter(n_courses >= 5) |>
  mutate(
    r_low = dense_rank(avg_q1),
    r_high = dense_rank(desc(avg_q1)),
    which = case_when(r_low == 1 ~ "lowest", r_high == 1 ~ "highest")
  ) |>
  filter(!is.na(which)) |>
  select(which, teacher_id, n_courses, avg_q1) |>
  arrange(desc(which)) 
```

-   Example using `across()`

```{r}
#| label: dvs-4-across

# Used data from Lab-4 to simulate

childcare_2018 <- ca_childcare |>
  filter(study_year == 2018)

childcare_summary <- childcare_2018 |>
  group_by(region) |>
  summarise(
    across(
      .cols = c(mc_infant, mc_toddler, mc_preschool),
      .fns = list(
        median = ~ median(.x, na.rm = TRUE),
        mean   = ~ mean(.x, na.rm = TRUE)
      ),
      .names = "{.col}_{.fn}"
    ),
    .groups = "drop"
  )
```

**DVS-5: I can find summaries of variables across multiple groups.**

-   Example 1

```{r}
#| label: dvs-5-1

# Lab 4, Question 5
median_income_region <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>
  group_by(region, study_year) %>%
  summarise(
    median_income_2018 = median(mhi_2018, na.rm = TRUE), 
    .groups = "drop") |>
  pivot_wider(names_from = study_year, 
  values_from = median_income_2018) |>
  arrange(desc(`2018`)) |>
  select(region, `2008`, `2018`)
```

-   Example 2

```{r}
#| label: dvs-5-2

# Lab 3, Question 10
teacher_evals_clean |>
  filter(question_no == "901") |>
  summarise(
    avg_q1 = mean(SET_score_avg, na.rm = TRUE),
    n_courses = n_distinct(course_id),
    .by = teacher_id
  ) |>
  filter(n_courses >= 5) |>
  mutate(
    r_low = dense_rank(avg_q1),
    r_high = dense_rank(desc(avg_q1)),
    which = case_when(r_low == 1 ~ "lowest", r_high == 1 ~ "highest")
  ) |>
  filter(!is.na(which)) |>
  select(which, teacher_id, n_courses, avg_q1) |>
  arrange(desc(which)) 
```

**DVS-6: I can create tables which make my summaries clear to the reader.**

-   I can modify my column names to clearly communicate the data context

```{r}
#| label: dvs-6-ex-1

# Lab 9, Question 5
evals |>
  select(academic_degree, seniority, sex) |>
  mutate(
    academic_degree = fct_recode(
      academic_degree,
      "No degree" = "no_dgr",
      "Master's" = "ma",
      "Doctorate" = "dr",
      "Professor" = "prof"
      ),
    sex = fct_recode(
      sex,
      "Female" = "female",
      "Male" = "male"
    ),
    seniority = recode_factor(
      as.character(seniority),
      "1" = "1 year",
      "2" = "2 years",
      "3" = "3 years",
      "4"  = "4 years",
      "5" = "5 years",
      "6"  = "6 years",
      "7"  = "7 years",
      "8"  = "8 years",
      "9"  = "9 years",
      "10" = "10 years",
      "11" = "11 years"
    )
  ) |>
  pivot_longer(
    cols = everything(),
    names_to = "Demographic",
    values_to = "Level"
  ) |>
  mutate(
    Demographic = recode(
      Demographic,
      academic_degree = "Academic degree",
      seniority = "Seniority",
      sex = "Sex"
      )
  ) |>
  count(Demographic, Level, name = "n") |>
  group_by(Demographic) |>
  mutate(Percent = round(100 * n / sum(n), 1)) |>
  ungroup() |>
  arrange(Demographic, Level) |>
  kable(
    col.names = c("Demographic", "Level", "n", "Percent")
  )
```

-   I can modify the text in my table to be more readable (e.g., bold face for column headers)

```{r}
#| label: dvs-6-ex-2

# Lab 9, Question 3
surveys |>
  map_chr(class) |>
  enframe(name = "Variable", value = "Data Type") |>
  arrange(Variable) |>
  kable(
    col.names = c("Variable", "Data Type"),
    caption   = "Table 1: Data Types of Variables in the 'surveys' Dataset"
  ) |>
  kable_styling(full_width = FALSE) |>
  row_spec(0, bold = TRUE)
```

-   I can arrange my table to have an intuitive ordering

```{r}
#| label: dvs-6-ex-3

# Lab 9, Question 6 
evals |>
  select(academic_degree, seniority, sex) |>
  mutate(
    across(everything(), as.factor),
    academic_degree = fct_recode(
      academic_degree,
      "No degree" = "no_dgr",
      "Master's"  = "ma",
      "Doctorate" = "dr",
      "Professor" = "prof"
    )
  ) |>
  pivot_longer(
    cols      = everything(),
    names_to  = "Demographic",
    values_to = "Category"
  ) |>
  count(Demographic, Category, name = "Count") |>
  group_by(Demographic) |>
  mutate(Percent = Count / sum(Count)) |>
  ungroup() |>
  arrange(Demographic, desc(Count)) |>
  kable(
    col.names = c("Variable", "Category", "Count", "%"),
    caption   = "Table 2: Instructor demographics in the 'evals' dataset",
    booktabs  = TRUE
  )
```

**DVS-7: I show creativity in my tables.**

-   I can use non-default colors

```{r}
#| label: dvs-7-ex-1

# Lab 8, Question 4
style_plot <- function(my_plot, theme_fn = theme_bw, 
                       palette = brewer.pal(8, "Set2"), aesthetic) {
  if (aesthetic == "fill"){
    my_plot + theme_fn() + scale_fill_manual(values = palette)
  } else {
    my_plot + theme_fn() + scale_color_manual(values = palette)
  }
}
```

-   I can modify the layout of my table to be more readable (e.g., `pivot_longer()` or `pivot_wider()`)

```{r}
#| label: dvs-7-ex-2

# Lab 8, Question 2
pivot_table <- function(df, row, col){
  df |>
    count({{ row }}, {{ col }}) |>
    pivot_wider(names_from = {{ col }},
                values_from = n,
                values_fill = 0) |>
    adorn_totals(where = c("row", "col"))
}
```

## Program Efficiency

**PE-1: I can write concise code which does not repeat itself.**

-   using a single function call with multiple inputs (rather than multiple function calls)

```{r}
#| label: pe-1-one-call

# Lab 8, Question 2
pivot_table <- function(df, row, col){
  df |>
    count({{ row }}, {{ col }}) |>
    pivot_wider(names_from = {{ col }},
                values_from = n,
                values_fill = 0) |>
    adorn_totals(where = c("row", "col"))
}
```

-   using `across()`

```{r}
#| label: pe-1-across

# Lab 3, Question 5
teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  group_by(course_id, teacher_id) |>
  filter(no_participants >= 10) |>
  ungroup() |>
  mutate(
  across(teacher_id, as.character),
  across(c(question_no, academic_degree, sex), as.factor),
  seniority = as.integer(seniority)
  ) |>
  select(
  course_id, teacher_id, question_no, no_participants, resp_share,
  SET_score_avg, percent_failed_cur, academic_degree, seniority, sex
)
```

-   using functions from the `map()` family

```{r}
#| label: pe-1-map-1

# Lab 9, Question 7
fish |>
  map_int(~ sum(is.na(.x))) |>
  enframe(name = "Variable", value = "n_missing") |>
  arrange(desc(n_missing)) |>
  kable(
    col.names = c("Variable", "Number of missing values"),
    caption   = "Number of missing values for each variable in the fish dataset"
  )
```

**PE-2: I can write functions to reduce repetition in my code.**

-   Example 1: Function that operates on vectors

```{r}
#| label: pe-2-1

# Lab 8, Question 1
rescale_01 <- function(vec) {
  if (!is.numeric({{ vec }})) stop("`vec` must be numeric.")
  if (length({{ vec }}) <= 1L) stop("`vec` must have length > 1.")
  
  rng <- range({{ vec }}, na.rm = TRUE)
  denom <- diff(rng)
  
  if (denom == 0) return(ifelse(is.na({{ vec }}), NA_real_, 0))
  
  ({{ vec }} - rng[1]) / denom
}
```

-   Example 2: Function that operates on data frames

```{r}
#| label: pe-2-2

# Lab 8, Question 2
pivot_table <- function(df, row, col){
  df |>
    count({{ row }}, {{ col }}) |>
    pivot_wider(names_from = {{ col }},
                values_from = n,
                values_fill = 0) |>
    adorn_totals(where = c("row", "col"))
}
```

-   Example 3: Function that operates on vectors *or* data frames

```{r}
#| label: pe-2-3

# Lab 8, Question 3
scatter_func <- function(df, x_var, y_var) {
  ggplot(data = df, aes(x = {{ x_var }}, y = {{ y_var }}, color = {{ x_var }})) +
    geom_point() + 
    labs(title = "Scatter Plot of Vars X and Y",
         x = "X Variable",
         y = "Y Variable",
         color = "X Variable") + 
    theme_minimal()
}
```

**PE-3:I can use iteration to reduce repetition in my code.**

-   using `across()`

```{r}
#| label: pe-3-across

# Lab 8, Question 1
rescale_01 <- function(vec) {
  if (!is.numeric({{ vec }})) stop("`vec` must be numeric.")
  if (length({{ vec }}) <= 1L) stop("`vec` must have length > 1.")
  
  rng <- range({{ vec }}, na.rm = TRUE)
  denom <- diff(rng)
  
  if (denom == 0) return(ifelse(is.na({{ vec }}), NA_real_, 0))
  
  ({{ vec }} - rng[1]) / denom
}

rescale_column <- function(df, cols) {
  df |>
    mutate(across({{ cols }}, rescale_01)) 
}
```

-   using a `map()` function with **one** input (e.g., `map()`, `map_chr()`, `map_dbl()`, etc.)

```{r}
#| label: pe-3-map-1

# Lab 9, Question 3
surveys |>
  map_chr(class) |>
  enframe(name = "Variable", value = "Data Type") |>
  arrange(Variable) |>
  kable(
    col.names = c("Variable", "Data Type"),
    caption = "Table 1: Data Types of Variables in the 'surveys' Dataset"
  ) |>
  kable_styling(full_width = FALSE) |>
  row_spec(0, bold = TRUE)
```

-   using a `map()` function with **more than one** input (e.g., `map_2()` or `pmap()`)

```{r}
#| label: pe-3-map-2

# Lab 9, Question 7
fish |>
  map_int(~ sum(is.na(.x))) |>
  enframe(name = "Variable", value = "n_missing") |>
  arrange(desc(n_missing)) |>
  kable(
    col.names = c("Variable", "Number of missing values"),
    caption   = "Number of missing values for each variable in the fish dataset"
  )
```

**PE-4: I can use modern tools when carrying out my analysis.**

-   I can use functions which are not superseded or deprecated

```{r}
#| label: pe-4-1

# Lab 4, Question 7
ggplot(plot_df, aes(study_year, price, color = region)) +
  geom_point(alpha = 0.5, size = 1.2) +
  geom_smooth(method = "loess", se = TRUE, linewidth = 0.8) +
  facet_wrap(~ age_group, nrow = 1) +
  scale_x_continuous(breaks = c(2008, 2010, 2012, 2014, 2016, 2018),
                     name = "Study Year") +
  scale_y_continuous(breaks = c(100, 200, 300, 400, 500),
                     labels = scales::number_format(accuracy = 1),  
                     name = NULL) +
  coord_cartesian(xlim = c(2008, 2018), ylim = c(100, 500), clip = "off") +
  scale_color_manual(values = cols, name = "California Region") +
  labs(title = "Weekly Median Price for Center-Based Childcare ($)") +
  theme_minimal(base_size = 12) +
  theme(
    aspect.ratio = 1,
    panel.grid.minor = element_blank(),
    axis.text.x = element_text(size = 6),   
    legend.position = "right",               
    legend.justification = "center",
    legend.box.margin = margin(0, 0, 0, 10),
    plot.margin = margin(5.5, 20, 5.5, 5.5)
  )
```

-   I can connect a data wrangling pipeline into a `ggplot()`

```{r}
#| label: pe-4-2

# Lab 1, Question 6
ToothGrowth |>
  mutate(dose = as.factor(dose)) |>
  ggplot(mapping = aes(x = dose, y = len)) +
  geom_boxplot() +
  labs(x = "Dose of Supplement (mg/day)", y = "Length of Teeth (mm)")
```

## Data Simulation & Statisical Models

**DSSM-1: I can simulate data from a *variety* of probability models.**

-   Example 1

```{r}
#| label: dsm-1-1

# Lab 10, Question 1
set.seed(2025)

randomBabies <- function(n_babies){
  true_ids <- 1:n_babies
  assigned_ids <- sample(true_ids, size = n_babies, replace = FALSE)
  sum(assigned_ids == true_ids)
}

results <- map_int(.x = 1:10000,
                   .f = ~ randomBabies(n_babies = 4)
                  )
```

-   Example 2

```{r}
#| label: dsm-1-2

# Lab 10, Question 4
set.seed(2026)

# define slope and intercept parameters
intercept = 2
slope = 1
n = 100

# generate x vector
x <- runif(n, min = 0, max = 1)

# generate noise `ep` vector
ep <- rnorm(n, mean = 0, sd = 1)

# generate outcome from population model
y = intercept + x*slope + ep

# create an "observed data" dataframe with only the x and y vectors
obs_dat <- tibble(x = x, y = y)
```

**DSSM-2: I can conduct common statistical analyses in R.**

-   Example 1

```{r}
#| label: dsm-2-1

# Lab 2, Question 17
summary(aov(weight ~ species, data = surveys))
```

-   Example 2

```{r}
#| label: dsm-2-2

# Lab 4, Question 9
reg_mod1 <- lm(mc_infant ~ mhi_2018, data = ca_childcare, subset = (study_year == 2018))
summary(reg_mod1)
```

-   Example 3

```{r}
#| label: dsm-2-3

# Lab 10, Question 6
slope_tidy <- tidy(lm_fit, conf.int = TRUE) |>
  filter(term == "x")

slope_tidy
```

## Revising My Thinking

Throughout the course, I have revised my thinking when completing assignments to find an approach that is able to complete the task in a way that is straightforward, efficient and easy to understand. I have tried to ensure to avoid redundancy and repetition in my code blocks. I have also tried to ensure that I am using the most up to date functions. This is to ensure I am using the most clear, straightforward methods available.

## Extending My Thinking

Thanks to the revisions provided on the labs throughout this course I have been able to extend my thinking and approach to assignments. One of the things I have learned to do is provide thorough explanations and descriptions of the data beyond the plots.

## Peer Support & Collaboration

Feedback that I gave:

"Great job! Your code is clear and your formatting is very tidy. I appreciated how you started a new line after each "+" symbol, This made the code very clear and easy to read."

Through the weekly pair programming activities, I have definitely noticed an improvement in my collaboration skills. I found that through the programmer vs coder system, it helped to ensure the work was spread evenly, rather than one person doing all of the work. When it was my turn to type, I typed what my partner said rather than what I wanted, and vice versa. If we were stuck on a particular problem, then we were able to ask each other for help, and if we still were not able to solve the problem collaboratively, we were able to ask our professor or TA for additional assistance.
